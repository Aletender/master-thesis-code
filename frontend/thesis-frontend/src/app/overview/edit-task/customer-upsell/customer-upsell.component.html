<ng-container *ngIf="!isLoading && customer">
  <mat-card class="customer-card">
    <mat-card-header>
      <mat-card-title>Kunde</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div><span class="customer-label">Name:</span> {{ customer.name }}</div>
      <div><span class="customer-label">Email:</span> {{ customer.email }}</div>
      <div *ngIf="customer.phone"><span class="customer-label">Telefon:</span> {{ customer.phone }}</div>
      <div *ngIf="customer.address"><span class="customer-label">Adresse:</span> {{ customer.address }}</div>
      <div *ngIf="customer.customerNumber"><span class="customer-label">Kundennummer:</span> {{ customer.customerNumber }}</div>
      <div class="customer-reason">{{ customerComment }}</div>
      <div *ngIf="customer.pets?.length">
        <mat-divider></mat-divider>
        <mat-card-title>Haustiere</mat-card-title>
        <div class="pet-list">
          <div class="pet-list-item" *ngFor="let pet of customer.pets">
            <span class="pet-icon">{{ getPetIcon(pet.species) }}</span>
            <span class="pet-name">{{ pet.name }}</span> ({{ pet.species }}
            <span *ngIf="pet.breed">, {{ pet.breed }}</span>
            <span *ngIf="pet.age">, {{ pet.age }} Jahre</span>
            <span *ngIf="pet.isNeutered !== undefined">, {{ pet.isNeutered ? 'kastriert' : 'nicht kastriert' }}</span>
            <span *ngIf="pet.birthDate">, geb. {{ pet.birthDate }}</span>
            )
            <div class="pet-reason" *ngIf="petComments[pet.name]">
              {{ petComments[pet.name] }}
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</ng-container>

<mat-card class="recommend-card" *ngIf="!isLoading">
  <mat-card-header>
    <mat-card-title>Empfohlene Produkte</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="loadingProducts" style="text-align:center; padding: 1em;">
      <mat-spinner diameter="32"></mat-spinner>
      <div>Produkte werden geladen ...</div>
    </div>
    <ng-container *ngIf="!loadingProducts && products.length">
      <app-product-card
        [name]="currentProduct.name"
        [description]="currentProduct.description"
        [price]="currentProduct.price"
        [sku]="currentProduct.sku"
        [category]="currentProduct.category"
        [brand]="currentProduct.brand"
        [stockQuantity]="currentProduct.stockQuantity"
        [shelfLocation]="currentProduct.shelfLocation"
        [isColdStorage]="currentProduct.isColdStorage"
        [targetAnimal]="currentProduct.targetAnimal"
        [recommendedAgeGroup]="currentProduct.recommendedAgeGroup"
        [weightGrams]="currentProduct.weightGrams"
        [packSize]="currentProduct.packSize"
        [imageUrl]="currentProduct.imageUrl"
        [tags]="currentProduct.tags"
        [reason]="currentProduct.reason"
      ></app-product-card>
      <div class="product-navigation-buttons">
        <button mat-raised-button color="primary" (click)="showPrevProduct()">
          <mat-icon>chevron_left</mat-icon>
          Zurück
        </button>
        <span class="product-index-info">{{ currentProductIndex + 1 }} / {{ products.length }}</span>
        <button mat-raised-button color="primary" (click)="showNextProduct()">
          Weiter
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    </ng-container>
    <div *ngIf="!loadingProducts && !products.length" style="text-align:center; color:#888; padding:1em;">
      Keine passenden Produkte gefunden.
    </div>
  </mat-card-content>
</mat-card>

<div style="text-align: right; margin-top: 16px;">
  <button mat-raised-button color="primary" (click)="close()">Schließen</button>
</div>
